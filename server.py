
import json, os
import sys
import time
from dotenv import load_dotenv
from fastapi import FastAPI
import google.generativeai as genai
from langchain_google_genai import ChatGoogleGenerativeAI
from langchain_google_vertexai import ChatVertexAI

from graphs.content_collation_subgraph import CourseSubSectionFlow
from data_models.data_collation_object import TopicState
from graphs.data_collation_graph import CourseContentFlow
from data_models.user_input_object import UserInput 

load_dotenv(os.getcwd()+"/local.env")       #/course_creation
app = FastAPI()

def get_model():  
    # genai.configure(api_key = os.environ['GEMINI_API_KEY'])
    # model = genai.GenerativeModel('gemini-1.5-pro',generation_config={"response_mime_type": "application/json"})  
    model = ChatGoogleGenerativeAI(model="gemini-1.5-flash-latest",
          google_api_key=os.environ['GEMINI_API_KEY'],
          verbose = True,
    )
    # model = ChatVertexAI(model="gemini-1.5-flash-001", 
    #                     temperature=0,
    #                     project_id="genai-hack-123")
    return model

@app.post("/coursetopic")
def sendTopicDetails(input: TopicState):
    model = get_model()
    workflow = CourseContentFlow(model) 
    app = workflow.runGraph()
    response = app.invoke(input)
    output = json.dumps(response)
    print(f"Result : {output}")
    return output

# if __name__ == "__main__":
#     # user_input = {"grade" : "Class 4", "subject" : "Science", "topic" : "Evaporation", "language" : "Hindi", "instructions": "Please create a short course for primary school kids", "review_status": "Pending"}
#     # input = {"input" : user_input}
#     input = {"input": {"grade": "Grade 3", "subject": "Science", "topic": "Friction", "language": "English", "instructions": "For primary classes", "review_status": "Done"}, "topic": "Friction", "summary": "## The Mystery of Friction: A Sticky Situation!\n\nImagine you're trying to slide a heavy box across the floor. It's hard, right? That's because of friction! \n\n**Question:** What do you think makes it hard to slide the box?\n\n**Answer:** The surface of the box and the floor are touching, and they don't want to move past each other. This resistance is friction!\n\n**Question:**  What happens when you push the box harder?\n\n**Answer:**  You overcome the friction and the box moves!\n\n**Question:**  What do you think happens if you put a rug under the box?\n\n**Answer:**  The rug makes the surface smoother, reducing friction, and the box slides easier!\n\n**Question:** Can you think of other examples of friction?\n\n**Answer:**  Friction helps us walk, stops our car, and even helps us write with a pencil!\n\n**In short, friction is a force that opposes motion between surfaces in contact. It can be helpful or annoying, depending on the situation!** \n", "course_plan": "## Friction: A Force That Holds Us Back (and Sometimes Helps!) \n\n**1. Types of Friction**\n\n* **Details:** Friction is a force that happens when two surfaces rub against each other. It's like a tiny brake that slows things down.\n* **Types:**\n    * **Static Friction:**  This friction keeps things still. Like when you push a heavy box, it won't move until you push hard enough to overcome static friction.\n    * **Sliding Friction:**  This friction happens when things slide against each other. Think of a sled on a snowy hill.\n    * **Rolling Friction:** This friction happens when things roll on a surface. It's much less than sliding friction, which is why wheels and tires are so helpful!\n* **Experiments:** \n    * Try rubbing your hands together - you'll feel the heat from friction!\n    * Push a toy car across a smooth surface and then across a rough surface - which one goes further?\n\n**2. Friction Applications**\n\n* **Details:**  Friction can be both helpful and annoying. It depends on what we want to do!\n* **Applicability:**\n    * **Walking:** Friction between our shoes and the ground lets us walk without slipping.\n    * **Braking:**  Friction in brakes helps cars stop.\n    * **Lighting a Match:**  Friction from striking the match creates heat, which ignites it.\n* **Real-life Examples:**\n    *  Gripping a pencil: Friction helps us hold things.\n    *  Wearing a coat:  Friction keeps the fabric of your coat from slipping off.\n    *  A dog chasing a ball: Friction between the dog's paws and the ground helps it run.\n\n**3. Friction Measurement**\n\n* **Details:**  We can measure friction using special instruments.\n* **Types:**\n    * **Coefficient of Friction:** This number tells us how strong the friction is between two surfaces.\n    * **Friction Force:**  This is the actual force of friction acting on an object.\n* **Experiments:**\n    *  Try dragging a block across different surfaces (wood, carpet, sandpaper) - which one has the most friction?\n\n**4. Friction Reduction**\n\n* **Details:**  Sometimes we want to reduce friction to make things move more easily.\n* **Applicability:**\n    * **Using Lubricants:**  Oil and grease reduce friction between moving parts, making machines run smoother.\n    * **Using Ball Bearings:**  These tiny balls help reduce friction in machines like bicycles.\n    * **Making Surfaces Smooth:**  A smooth surface has less friction than a rough one.\n* **Real-life Examples:**\n    *  Using wheels on a shopping cart to move it easily.\n    *  Adding oil to a squeaky door hinge.\n    *  Skating on ice:  Ice is very smooth and has low friction, allowing us to glide easily.\n\n**5. Friction Effects**\n\n* **Details:** Friction has some effects on things we use everyday.\n* **Types:**\n    * **Heat:**  Friction creates heat! That's why rubbing your hands together makes them warm.\n    * **Wear and Tear:**  Friction can wear down surfaces over time, like the soles of your shoes.\n    * **Sound:**  Friction can create sounds, like the screeching of brakes or the rustling of leaves.\n* **Real-life Examples:**\n    *  The heat from a car's brakes when you stop.\n    *  The worn-out tire treads on a car.\n    *  The sound of a door opening and closing. \n", "sections_list": ["Types of Friction", " Friction Applications", " Friction Measurement", " Friction Reduction", " Friction Effects"], "sections": [{"main_topic": "Friction", "section_name": "Types of Friction", "section_details": "Friction is a force that opposes motion between two surfaces in contact. There are different types of friction, each with its own characteristics and causes. **Static friction** acts on objects at rest, preventing them from moving. Think of a heavy box on the floor\u2014you need to apply force to overcome static friction and get it moving. Once the object starts moving, **kinetic friction** takes over, opposing the object's motion.  Imagine sliding that box across the floor\u2014the force you need to keep it moving is kinetic friction.  **Rolling friction** occurs between a rolling object and the surface it's rolling on, like a car's tires on the road.  It's generally less than sliding friction, which is why rolling objects move more easily. Finally, **fluid friction**, also known as drag, occurs when an object moves through a fluid, like air or water.  This type of friction is what slows down a plane or a swimmer.", "section_summary": "Friction, a force opposing motion, comes in different types: static, kinetic, rolling, and fluid.  Each type plays a role in how objects move and interact with their surroundings.", "section_review": "Done"}, {"main_topic": "Friction", "section_name": " Friction Applications", "section_details": "Friction plays a vital role in numerous applications across various fields. In everyday life, we depend on friction to walk, write, and even drive. It provides the grip needed to hold objects, allows us to stop moving vehicles, and enables machines to operate smoothly. Friction is also crucial in industrial processes, such as in brakes, clutches, and bearings, where it helps control motion and prevent wear. Furthermore, friction is essential in sports, allowing athletes to gain traction on surfaces and perform various movements. While friction can cause wear and tear, it is an indispensable force that makes many everyday activities and technological advancements possible.", "section_summary": "Friction is essential for various applications, from everyday activities like walking and writing to industrial processes and sports, enabling motion control, preventing wear, and providing grip.", "section_review": "Done"}, {"main_topic": "Friction", "section_name": " Friction Measurement", "section_details": "Measuring friction is essential for understanding and predicting how objects interact.  There are various methods, depending on the situation.  For simple surfaces, a friction coefficient can be determined by measuring the force required to start or maintain motion.  More sophisticated techniques involve using sensors to measure the force and displacement of objects during contact.  These measurements can then be analyzed to determine the friction characteristics of the materials involved.", "section_summary": "Measuring friction helps us understand how surfaces interact and how much force is needed to overcome that resistance. Different methods exist, from simple force measurements to advanced sensor-based techniques, depending on the complexity of the situation.", "section_review": "Done"}, {"main_topic": "Friction", "section_name": " Friction Reduction", "section_details": "Friction reduction is all about minimizing the resistance between surfaces in contact. It's like making things slide or roll more smoothly. This can be achieved through various methods like using lubricants, smoothing surfaces, or even changing the materials themselves. Reducing friction is essential in many applications, from improving engine efficiency to reducing wear and tear in machines. It's also crucial in everyday life, like making it easier to push a heavy box across the floor or allowing us to enjoy a smooth ride on a bike.", "section_summary": "Friction reduction involves minimizing resistance between surfaces, leading to smoother movement and increased efficiency. This is achieved by using lubricants, smoothing surfaces, or modifying materials. Friction reduction has significant applications in various fields, from engineering to everyday life.", "section_review": "Done"}, {"main_topic": "Friction", "section_name": " Friction Effects", "section_details": "Friction plays a crucial role in our daily lives, influencing everything from walking to driving. Understanding its effects is essential for making informed decisions. Friction can either be helpful or harmful, depending on the situation. For instance, friction allows us to grip objects, write with pencils, and prevent slipping on surfaces. However, it can also cause wear and tear on moving parts, generate heat, and reduce efficiency in machines.  Friction can be categorized into different types, including static friction, which prevents objects from moving, and kinetic friction, which resists motion between objects that are already moving. By understanding the principles of friction, we can minimize its negative effects and utilize its positive aspects to our advantage.  ", "section_summary": "Friction is a force that either helps or hinders movement, depending on the situation. It plays a critical role in daily life, influencing everything from walking to driving. Understanding the different types and effects of friction allows us to optimize its use and minimize its negative consequences.", "section_review": "Done"}]}
#     start_time = time.process_time()
#     out = sendTopicDetails(input)
#     end_time = time.process_time()
#     print(f"Total time taken : {end_time}-{start_time}")

# if __name__ == "__main__":
#     import uvicorn

#     uvicorn.run(app, host="localhost", port=8000)


# Steps to run (on separate windows)
# -----------------------------------
# python server.py
# streamlit run app.py